# Firestore Database Structure

## Collections Overview

This app uses two main Firestore collections: `users` and `courses`.

---

## 1. Users Collection

**Collection Name:** `users`

**Document ID:** User's UID (from Firebase Authentication)

**Fields:**
```json
{
  "name": "string",           // User's full name
  "email": "string",           // User's email address
  "createdAt": "timestamp"    // Server timestamp when user registered
}
```

**Example Document:**
```json
{
  "name": "John Doe",
  "email": "john.doe@example.com",
  "createdAt": "2024-01-15T10:30:00Z"
}
```

**Document Path Example:**
```
users/{userUID}
users/abc123xyz456
```

---

## 2. Courses Collection

**Collection Name:** `courses`

**Document ID:** Auto-generated by Firestore (using `.add()`)

**Fields:**
```json
{
  "title": "string",                    // Course title
  "description": "string",              // Course description
  "createdBy": "string",                // UID of user who created the course
  "enrolledUsers": ["array of UIDs"],   // Array of user UIDs who enrolled
  "createdAt": "timestamp"             // Server timestamp when course was created
}
```

**Example Document:**
```json
{
  "title": "Introduction to Flutter",
  "description": "Learn Flutter development from scratch",
  "createdBy": "abc123xyz456",
  "enrolledUsers": ["abc123xyz456", "def789uvw012"],
  "createdAt": "2024-01-15T11:00:00Z"
}
```

**Document Path Example:**
```
courses/{autoGeneratedId}
courses/course123abc
```

---

## Visual Structure

```
Firestore Database
│
├── users (Collection)
│   ├── {userUID1} (Document)
│   │   ├── name: "John Doe"
│   │   ├── email: "john@example.com"
│   │   └── createdAt: Timestamp
│   │
│   ├── {userUID2} (Document)
│   │   ├── name: "Jane Smith"
│   │   ├── email: "jane@example.com"
│   │   └── createdAt: Timestamp
│   │
│   └── ...
│
└── courses (Collection)
    ├── {courseId1} (Document)
    │   ├── title: "Course 1"
    │   ├── description: "Description"
    │   ├── createdBy: "userUID1"
    │   ├── enrolledUsers: ["userUID1", "userUID2"]
    │   └── createdAt: Timestamp
    │
    ├── {courseId2} (Document)
    │   ├── title: "Course 2"
    │   ├── description: "Description"
    │   ├── createdBy: "userUID2"
    │   ├── enrolledUsers: ["userUID1"]
    │   └── createdAt: Timestamp
    │
    └── ...
```

---

## How to Set Up Firebase (If You Don't Have an Account)

### Step 1: Create Firebase Account
1. Go to https://console.firebase.google.com/
2. Click "Get Started" or "Add Project"
3. Sign in with your Google account (or create one)

### Step 2: Create a New Project
1. Click "Add Project" or "Create a Project"
2. Enter project name: `assignment-2-b248b` (or any name you prefer)
3. Disable Google Analytics (optional, for simplicity)
4. Click "Create Project"

### Step 3: Enable Authentication
1. In Firebase Console, go to **Authentication**
2. Click "Get Started"
3. Enable **Email/Password** authentication:
   - Click on "Email/Password"
   - Toggle "Enable" to ON
   - Click "Save"

### Step 4: Create Firestore Database
1. In Firebase Console, go to **Firestore Database**
2. Click "Create Database"
3. Choose **Start in test mode** (for development)
   - This allows read/write access for 30 days
   - **Important:** For production, set up proper security rules
4. Select a location (choose closest to your region)
5. Click "Enable"

### Step 5: Get Your Firebase Configuration
1. In Firebase Console, click the gear icon ⚙️ → **Project Settings**
2. Scroll down to "Your apps"
3. Click the **Web** icon (`</>`) to add a web app
4. Register app with nickname (e.g., "Flutter Web App")
5. Copy the Firebase configuration object

### Step 6: Update Your Flutter App
1. The `firebase_options.dart` file should already have your config
2. If you created a new project, you'll need to regenerate it:
   ```bash
   flutterfire configure
   ```
   Or manually update `lib/firebase_options.dart` with your new config

### Step 7: Security Rules (Important!)
Go to Firestore Database → Rules and update to:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection: users can read/write their own document
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Courses collection: authenticated users can read all, create new, and update enrollments
    match /courses/{courseId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update: if request.auth != null;
      allow delete: if request.auth != null && 
        resource.data.createdBy == request.auth.uid;
    }
  }
}
```

**Note:** The test mode rules allow all reads/writes for 30 days. Update to the rules above for better security.

---

## Testing the Structure

### Create a Test User (via App)
1. Run the app
2. Register a new user
3. Check Firestore Console → `users` collection
4. You should see a document with the user's UID

### Create a Test Course (via App)
1. Login to the app
2. Click the "+" button to add a course
3. Fill in title and description
4. Check Firestore Console → `courses` collection
5. You should see a new document with auto-generated ID

### Enroll in a Course (via App)
1. Click "Enroll" on any course
2. Check Firestore Console → `courses` → select course document
3. The `enrolledUsers` array should now include your user UID

---

## Field Types Summary

| Field | Type | Description |
|-------|------|-------------|
| `name` | String | User's full name |
| `email` | String | User's email address |
| `createdAt` | Timestamp | Server timestamp |
| `title` | String | Course title |
| `description` | String | Course description |
| `createdBy` | String | User UID who created the course |
| `enrolledUsers` | Array of Strings | Array of user UIDs who enrolled |

---

## Notes

- **Document IDs:**
  - `users`: Uses Firebase Auth UID as document ID
  - `courses`: Auto-generated by Firestore (using `.add()`)

- **Timestamps:**
  - Use `FieldValue.serverTimestamp()` to ensure consistent server-side timestamps

- **Arrays:**
  - `enrolledUsers` uses `FieldValue.arrayUnion([uid])` to add UIDs without duplicates

